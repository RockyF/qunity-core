{"version":3,"file":"test1.js","sources":["../src/HashObject.ts","../src/Entity.ts","test1.ts"],"sourcesContent":["/**\n * Created by rockyl on 2018/11/5.\n */\n\nlet HASH_CODE_INK: number = 0;\n\nfunction getHashCode() {\n\treturn ++HASH_CODE_INK;\n}\n\n/**\n * 哈希对象\n */\nexport default class HashObject {\n\tprivate _hashCode: number;\n\t\n\tconstructor() {\n\t\tthis._hashCode = getHashCode();\n\t}\n\n\tget hashCode(): number {\n\t\treturn this._hashCode;\n\t}\n}\n","/**\n * Created by rockyl on 2019-07-28.\n */\n\nimport HashObject from \"./HashObject\";\n\n/**\n * 实体类\n */\nexport class Entity extends HashObject {\n\tname: string;\n\n\tprivate _children: Entity[] = [];\n\tprivate _parent: Entity;\n\tprotected _enabled: boolean = false;\n\tprotected _isFree: boolean = true;\n\n\t/**\n\t * 所有子实体\n\t */\n\tget children(): Entity[] {\n\t\treturn this._children;\n\t}\n\n\t/**\n\t * 父实体\n\t */\n\tget parent(): Entity {\n\t\treturn this._parent;\n\t}\n\n\t/**\n\t * 是否游离态\n\t */\n\tget isFree(): boolean {\n\t\treturn this._isFree;\n\t}\n\n\t/**\n\t * 是否有效\n\t */\n\tget enabled(): boolean {\n\t\treturn this._enabled;\n\t}\n\n\tset enabled(value: boolean) {\n\t\tif (this._enabled != value) {\n\t\t\tthis._enabled = value;\n\t\t\tif(!this._isFree){\n\t\t\t\tif (this._enabled) {\n\t\t\t\t\tthis.validate();\n\t\t\t\t} else {\n\t\t\t\t\tthis.invalidate(true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * 实例化实体\n\t * @param name\n\t */\n\tconstructor(name?: string) {\n\t\tsuper();\n\n\t\tif (name) {\n\t\t\tthis.name = name;\n\t\t}\n\t}\n\n\t/**\n\t * 增加子实体\n\t * @param child\n\t * @param index\n\t */\n\taddChild(child: Entity, index?: number) {\n\t\tif (index == undefined || index < 0 || index >= this._children.length) {\n\t\t\tindex = this._children.length;\n\t\t}\n\n\t\tif (child._parent == this) {\n\t\t\tindex--;\n\t\t}\n\n\t\tthis.doAddChild(child, index);\n\t}\n\n\t/**\n\t * 移除子实体\n\t * @param child\n\t */\n\tremoveChild(child: Entity) {\n\t\tif (this.containsChild(child)) {\n\t\t\tchild._parent = null;\n\n\t\t\tlet index = this.getChildIndex(child);\n\t\t\tthis._children.splice(index, 1);\n\n\t\t\tif(!this._isFree){\n\t\t\t\tchild._free();\n\t\t\t\tif(this._enabled){\n\t\t\t\t\tchild.invalidate();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.onRemoveChild(child);\n\t\t}\n\t}\n\n\t/**\n\t * 通过索引移除实体\n\t * @param index\n\t */\n\tremoveChildAt(index: number) {\n\t\tlet child: Entity = this.getChildAt(index);\n\t\tif (child) {\n\t\t\tthis.removeChild(child);\n\t\t}\n\t}\n\n\t/**\n\t * 获取实体\n\t * @param index\n\t */\n\tgetChildAt(index: number): Entity {\n\t\treturn this._children[index];\n\t}\n\n\t/**\n\t * 获取子实体的索引\n\t * @param child\n\t */\n\tgetChildIndex(child: Entity): number {\n\t\treturn this._children.indexOf(child);\n\t}\n\n\t/**\n\t * 是否包含子实体\n\t * @param child\n\t */\n\tcontainsChild(child: Entity): boolean {\n\t\treturn child.parent == this;\n\t}\n\n\t/**\n\t * 遍历子实体\n\t * @param callback\n\t */\n\teachChild(callback: (child: Entity, index: number) => unknown) {\n\t\tthis._children.some(callback);\n\t}\n\n\tprivate doAddChild(child: Entity, index: number) {\n\t\tif (child == this) {\n\t\t\treturn;\n\t\t}\n\t\tlet parent = child.parent;\n\t\tif (parent) {\n\t\t\tif (parent == this) {\n\t\t\t\tlet currentIndex = this.getChildIndex(child);\n\t\t\t\tif (currentIndex != index) {\n\t\t\t\t\tthis._children.splice(currentIndex, 1);\n\t\t\t\t\tthis._children.splice(index, 0, child);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tparent.removeChild(child);\n\t\t\t}\n\t\t}\n\t\tif (!child.parent) {\n\t\t\tchild._parent = this;\n\t\t\tthis._children.splice(index, 0, child);\n\n\t\t\tif(!this._isFree){\n\t\t\t\tchild._restrict();\n\t\t\t\tif(this._enabled){\n\t\t\t\t\tchild.validate();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.onAddChild(child);\n\t\t}\n\t}\n\n\t/**\n\t * 使实体生效\n\t */\n\tprivate validate(force = false) {\n\t\tif (force || this._enabled) {\n\t\t\tthis.onEnable();\n\n\t\t\tthis.eachChild(child => {\n\t\t\t\tchild.validate();\n\t\t\t})\n\t\t}\n\t}\n\n\t/**\n\t * 使实体失效\n\t */\n\tprivate invalidate(force = false) {\n\t\tif (force || this._enabled) {\n\t\t\tthis.onDisable();\n\n\t\t\tthis.eachChild(child => {\n\t\t\t\tchild.invalidate();\n\t\t\t})\n\t\t}\n\t}\n\n\t/**\n\t * 使约束\n\t * @private\n\t */\n\tprivate _restrict() {\n\t\tthis._isFree = false;\n\t\tthis.eachChild(child => {\n\t\t\tchild._restrict();\n\t\t})\n\t}\n\n\t/**\n\t * 使游离\n\t * @param includeSelf\n\t */\n\tprivate _free(includeSelf = true) {\n\t\tthis._isFree = true;\n\t\tthis.eachChild(child => {\n\t\t\tchild._free();\n\t\t})\n\t}\n\n\t/**\n\t * 当实体生效时\n\t */\n\tprivate onEnable() {\n\t\tconsole.log('onEnable', this.name);\n\t}\n\n\t/**\n\t * 当实体失效时\n\t */\n\tprivate onDisable() {\n\t\tconsole.log('onDisable', this.name);\n\t}\n\n\t/**\n\t * 当添加子实体时\n\t * @param child\n\t */\n\tprivate onAddChild(child: Entity) {\n\n\t}\n\n\t/**\n\t * 当移除子实体时\n\t * @param child\n\t */\n\tprivate onRemoveChild(child: Entity) {\n\n\t}\n\n\n}\n\nexport class RootEntity extends Entity{\n\tprotected _isFree: boolean = false;\n\tprotected _enabled: boolean = true;\n}\n","/**\n * Created by rockyl on 2019-07-29.\n */\n\nimport {Entity, RootEntity} from \"../src\";\n\nlet root = new RootEntity('root');\nlet entity1 = new Entity('entity1');\nlet entity2 = new Entity('entity2');\nlet entity3 = new Entity('entity3');\n\nentity1.enabled = true;\nentity2.enabled = true;\nentity3.enabled = true;\n\nroot.addChild(entity1);\nentity1.addChild(entity2);\nentity2.addChild(entity3);\n\n//root.addChild(entity1);\n\n//root.removeChild(entity1);\n//entity1.removeChild(entity2);\n//entity1.enabled = true;\n\nentity2.enabled = true;\n//entity1.enabled = false;\n\n//console.log(root);\n"],"names":["tslib_1.__extends"],"mappings":"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"}